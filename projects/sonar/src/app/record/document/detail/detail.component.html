<!--
 SONAR UI
 Copyright (C) 2019 RERO

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as published by
 the Free Software Foundation, version 3 of the License.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ng-container *ngIf="record$ | async as record">
  <h1>
    {{ record.metadata.title[0].mainTitle | languageValue }}
  </h1>
  <h5 *ngIf="record.metadata.title[0].subtitle" class="text-muted">
    {{ record.metadata.title[0].subtitle | languageValue }}
  </h5>
  <dl class="row mt-4">
    <ng-container *ngIf="record.metadata.institution">
      <dt class="col-sm-2" translate>Institution</dt>
      <dd class="col-sm-10">{{ record.metadata.institution.name | translate }}</dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.contribution">
      <dt class="col-sm-2" translate>Contributions</dt>
      <dd class="col-sm-10">
        <ul class="list-unstyled mb-0">
          <li *ngFor="let contribution of record.metadata.contribution; let last = last">
            <small class="badge badge-secondary text-uppercase text-light">{{ contribution.agent.type }}</small>
            {{ contribution.agent.preferred_name }}
            <small class="badge badge-light text-uppercase">{{ contribution.role }}</small>
          </li>
        </ul>
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.type">
      <dt class="col-sm-2" translate>Document type</dt>
      <dd class="col-sm-10 text-justify">
        {{ ('type-' + record.metadata.type) | translate }}
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.copyrightDate">
      <dt class="col-sm-2" translate>Copyright date</dt>
      <dd class="col-sm-10 text-justify">
        {{ record.metadata.copyrightDate | join : ', ' }}
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.abstracts">
      <dt class="col-sm-2" translate>Abstract</dt>
      <dd class="col-sm-10 text-justify">
        {{ record.metadata.abstracts | languageValue }}
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.extent">
      <dt class="col-sm-2" translate>Physical description</dt>
      <dd class="col-sm-10">{{ record.metadata.extent }}</dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.additionalMaterials">
      <dt class="col-sm-2" translate>Additional Materials</dt>
      <dd class="col-sm-10">{{ record.metadata.additionalMaterials }}</dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.series">
      <dt class="col-sm-2" translate>Series</dt>
      <dd class="col-sm-10">
        <span *ngFor="
            let serie of record.metadata.series;
            let last = last
          ">
          {{ serie.name }}, {{ serie.number }}<span *ngIf="!last">; </span>
        </span>
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.is_part_of">
      <dt class="col-sm-2" translate>Is part of</dt>
      <dd class="col-sm-10">{{ record.metadata.is_part_of }}</dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.subjects">
      <dt class="col-sm-2" translate>Subjects</dt>
      <dd class="col-sm-10">
        <span *ngFor="
            let subject of record.metadata.subjects | languageValue;
            let last = last
          ">
          {{ subject }}<span *ngIf="!last">; </span>
        </span>
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.notes">
      <dt class="col-sm-2" translate>Notes</dt>
      <dd class="col-sm-10">
        <p class="m-0" *ngFor="let note of record.metadata.notes">{{ note }}</p>
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.identifiedBy">
      <dt class="col-sm-2" translate>Identifier</dt>
      <dd class="col-sm-10">
        <p class="m-0" *ngFor="let identifier of record.metadata.identifiedBy">
          {{ identifier.value }}
          <small class="badge badge-secondary text-uppercase text-light">{{ identifier.type | translate }}</small>
        </p>
      </dd>
    </ng-container>

    <ng-container *ngIf="record.metadata.language">
      <dt class="col-sm-2" translate>Languages</dt>
      <dd class="col-sm-10">
        <span *ngFor="let language of record.metadata.language">
          {{ ('lang-' + language.value) | translate }}
        </span>
      </dd>
    </ng-container>
  </dl>

  <ng-container *ngIf="record.metadata._files">
    <h5 class="mt-5" translate>Files</h5>
    <table class="table">
      <thead>
        <tr>
          <th translate>Label</th>
          <th translate>File</th>
          <th translate>Size</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let file of filterFiles(record.metadata._files)">
          <td>{{ file.label | default:'-' }}</td>
          <td>{{ file.key }}</td>
          <td>{{ file.size | filesize }}</td>
          <td class="text-right">
            <a href (click)="$event.preventDefault(); previewFileKey = file.key; previewModal.show()"
              class="btn btn-secondary btn-sm text-light previewLink mr-2"><i class="fa fa-eye"></i>
              {{ 'Preview' | translate }}</a>
            <a [href]="file.key | fileLink: 'documents':record.metadata.pid:'files'" target="_blank"
              class="btn btn-secondary btn-sm text-light"><i class="fa fa-download"></i>
              {{ 'Download' | translate }}</a>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>

  <!--Preview modal-->
  <div bsModal #previewModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
    aria-labelledby="dialog-sizes-name1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 id="dialog-sizes-name1" class="modal-title pull-left">{{ previewFileKey }}</h4>
          <button type="button" class="close pull-right" (click)="previewModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <iframe class="preview-iframe" id="preview-iframe" width="100%" height="500"
            [src]="previewFileKey | fileLink: 'documents':record.metadata.pid:'preview'" style="border: none;"
            *ngIf="previewFileKey"></iframe>
        </div>
      </div>
    </div>
  </div>
</ng-container>
